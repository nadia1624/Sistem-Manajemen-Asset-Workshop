<%- include("../../layout/sidebar.ejs") %>

<main class="content">
  <div class="header-content">
    <h3 style="font-weight: bold;">Penyerahan Aset</h3>
    <div class="search-bar">
      <input placeholder="Search..." type="text" />
      <i class="fas fa-search"></i>
    </div>
  </div>
  <div class="container-fluid px-4">
    <div class="table-wrapper">
      <div class="table-responsive">
        <div class="table-bungkus">
          <div class="table-scroll">
            <table class="table-compact">
              <thead>
                <tr>
                  <th>No</th>
                  <th>Nama</th>
                  <th>Unit Kerja</th>
                  <th>Nama Aset</th>
                  <th>Kategori</th>
                  <th>Gambar</th>
                  <th>Status</th>
                  <th>Aksi</th>
                </tr>
              </thead>
              <tbody>
                <% if (penyerahanData && penyerahanData.length > 0) { %>
                  <% penyerahanData.forEach((item, index) => { %>
                    <tr>
                      <td><%= index + 1 %></td>
                      <td><%= item.Permintaan?.Aset?.nama_penerima || '-' %></td>
                      <td><%= item.Permintaan?.Aset?.unit_kerja || '-' %></td>
                      <td><%= item.Permintaan?.Aset?.nama_aset || '-' %></td>
                      <td><%= item.Permintaan?.Aset?.kategori || '-' %></td>
                      <td>
                        <% if (item.Permintaan?.Aset?.gambar) { %>
                          <img class="img-fluid" src="<%= item.Permintaan.Aset.gambar %>" alt="Gambar Aset" />
                        <% } else { %>
                          Tidak ada gambar
                        <% } %>
                      </td>
                      <td>
                        <% if (item.status_penyerahan === 'belum diserahkan') { %>
                          <span style="background-color: #dd5f61; color: white; padding: 5px;">Belum Diserahkan</span>
                        <% } else { %>
                          <span style="background-color: #A2E180; color: black; padding: 5px;">Telah Diserahkan</span>
                        <% } %>
                      </td>
                      <td>
                        <% if (item.status_penyerahan === 'belum diserahkan') { %>
                          <button class="btn btn-setuju" onclick="showModal('serahkan', '<%= item.id %>', '<%= item.Permintaan.Aset.nama_aset %>')">
                            Serahkan
                          </button>
                        <% } else { %>
                          <button class="btn btn-action">
                            Unduh Dokumen
                          </button>
                        <% } %>
                      </td>
                    </tr>
                  <% }); %>
                <% } else { %>
                  <tr>
                    <td colspan="8" class="text-center">Tidak ada data penyerahan.</td>
                  </tr>
                <% } %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>


    <!-- Modal -->
    <div id="addModal" class="popup-modal">
        <div class="modal-content">
            <span id="close" class="close-btn" >&times;</span>
            <h3 id="modalTitle"></h3>
            <p id="modalContent"></p>
            <div class="flex justify-center space-x-4">
                <button type="button" class="btn cancel-btn">Tidak</button>
                <button type="submit" class="btn finish-btn">Ya</button>
            </div>
        </div>
    </div>
    
<script>
const modal = document.getElementById("addModal");
const closeBtn = document.getElementById("close");
const modalTitle = document.getElementById("modalTitle");
const modalContent = document.getElementById("modalContent");
const cancelBtn = document.querySelector(".cancel-btn");

// Function to show modal
function showModal(action, no, namaAset) {
    modal.style.display = "flex";

    if (action === "serahkan") {
        modalTitle.textContent = "Konfirmasi Penyerahan Aset";
        modalContent.textContent = `Apakah Anda yakin ingin menyerahkan aset "${namaAset}" dengan nomor ${no}?`;
    } else if (action === "generate") {
        modalTitle.textContent = "Generate Dokumen";
        modalContent.textContent = `Apakah Anda ingin mengunduh dokumen terkait aset "${namaAset}" dengan nomor ${no}?`;
    }
}

// Close modal when clicking the close button
closeBtn.onclick = function () {
    addModal.style.display = "none";
};

// Close modal when clicking the cancel button
cancelBtn.onclick = function () {
    addModal.style.display = "none";
};

// Close modal when clicking outside the modal content
window.onclick = function (event) {
    if (event.target === modal) {
        modal.style.display = "none";
    }
};

</script>
